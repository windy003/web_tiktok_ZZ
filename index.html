<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机展示tiktok作者视频</title>
    <link rel="apple-touch-icon" sizes="180x180" href="180x180.png">
    <style>
        a{
            color: #333;
            text-decoration: none;
        }
    </style>
</head>
<body style="background-color:  #F2F0E9;">
    <h1>随机展示tiktok作者视频</h1>
    


    <div style="margin-top: 20px; font-size: 20px;">
        <label for="menu">选择爬取的作者</label>            
        <select id="menu" style="font-size: 20px; color: #333; background-color: #f6f2f2; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
            <option value="1">tiffInTech</option>
            <option value="2">2</option>
        </select>
    </div>

    <div id="info" style="margin-top: 20px; font-size: 20px; font-style: italic;color: #5007d7;"></div>
    
    <div id="output" style="margin-top: 30px; font-size: 24px; line-height: 1.6;"></div>
    
        <button id="refreshButton" style="margin-top: 20px; font-size: 20px; background-color: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
            刷新内容
        </button>
    
    <script>
        // 获取页面元素
        const menuSelect = document.getElementById('menu');
        const infoDiv = document.getElementById('info');
        const refreshButton = document.getElementById('refreshButton');
        
        // 为刷新按钮添加点击事件
        refreshButton.addEventListener('click', loadAndDisplayRandomItems);
        
        // 为下拉菜单添加变更事件
        menuSelect.addEventListener('change', loadAndDisplayRandomItems);
        
        // 加载并显示随机项目的函数
        async function loadAndDisplayRandomItems() {
            const selectedValue = menuSelect.value;
            let fileName = '';
            
            if (selectedValue === '1') {
                fileName = 'stocks/tiffInTech.json';
                infoDiv.textContent = '正在展示 tiffInTech 的内容';
            } else if (selectedValue === '2') {
                fileName = 'stocks/2.json';
                infoDiv.textContent = '正在展示 2 的内容';
            }
            
            try {
                // 获取JSON文件
                const response = await fetch(fileName);
                if (!response.ok) {
                    throw new Error('网络响应不正常');
                }
                const data = await response.json();
                
                // 将对象转换为数组以便随机选择
                const entries = Object.entries(data);
                
                // 随机选取5个条目
                const randomEntries = getRandomElements(entries, 5);
                
                // 创建超链接并显示
                const output = document.getElementById('output');
                output.innerHTML = randomEntries.map(([url, itemData]) => {
                    // 使用pub_time作为链接文本，如果为null则使用"查看视频"
                    const linkText = itemData.pub_time || "查看视频";
                    // 如果有desc，则在链接下方显示描述
                    const descText = itemData.desc ? `<div style="font-size: 18px; color: #666; margin-top: 5px;">${itemData.desc}</div>` : '';
                    
                    return `<div style="margin-bottom: 30px;">
                        <a href="${url}" target="_blank" style="color: #1DA1F2; font-weight: bold;">${linkText}</a>
                        ${descText}
                    </div>`;
                }).join('');
            } catch (error) {
                console.error('读取JSON文件失败:', error);
                output.innerHTML = `<div style="color: red;">加载数据失败: ${error.message}</div>`;
            }

            window.scrollTo(0, 0);
        }

        // 随机选取元素的函数
        function getRandomElements(array, count) {
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
        
        // 页面加载时调用
        window.onload = loadAndDisplayRandomItems;
    </script>
</body>
</html>
